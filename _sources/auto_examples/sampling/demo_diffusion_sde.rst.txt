
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/sampling/demo_diffusion_sde.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_sampling_demo_diffusion_sde.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_sampling_demo_diffusion_sde.py:


Building your diffusion posterior sampling method using SDEs
============================================================

This demo shows you how to use
:class:`deepinv.sampling.PosteriorDiffusion` to perform posterior sampling. It also can be used to perform unconditional image generation with arbitrary denoisers, if the data fidelity term is not specified.

This method requires:

* A well-trained denoiser with varying noise levels (ideally with large noise levels) (e.g., :class:`deepinv.models.NCSNpp`).

* A (noisy) data fidelity term (e.g., :class:`deepinv.sampling.DPSDataFidelity`).

* Define a drift term :math:`f(x, t)` and a diffusion term :math:`g(t)` for the forward-time SDE. They can be defined through the :class:`deepinv.sampling.DiffusionSDE` (e.g., :class:`deepinv.sampling.VarianceExplodingDiffusion`).

The :class:`deepinv.sampling.PosteriorDiffusion` class can be used to perform posterior sampling for inverse problems.
Consider the acquisition model:

.. math::
     y = \noise{\forw{x}}

where :math:`\forw{x}` is the forward operator (e.g., a convolutional operator) and :math:`\noise{\cdot}` is the noise operator (e.g., Gaussian noise).
This class defines the reverse-time SDE for the posterior distribution :math:`p(x|y)` given the data :math:`y`:

.. math::
     d\, x_t = \left( f(x_t, t) - \frac{1 + \alpha}{2} g(t)^2 \nabla_{x_t} \log p_t(x_t | y) \right) d\,t + g(t) \sqrt{\alpha} d\, w_{t}

where :math:`f` is the drift term, :math:`g` is the diffusion coefficient and :math:`w` is the standard Brownian motion.
The drift term and the diffusion coefficient are defined by the underlying (unconditional) forward-time SDE `sde`.
In this example, we will use 2 well-known SDE in the literature: the Variance-Exploding (VE) and Variance-Preserving (VP or DDPM).

The (conditional) score function :math:`\nabla_{x_t} \log p_t(x_t | y)` can be decomposed using the Bayes' rule:

.. math::
     \nabla_{x_t} \log p_t(x_t | y) = \nabla_{x_t} \log p_t(x_t) + \nabla_{x_t} \log p_t(y | x_t).

The first term is the score function of the unconditional SDE, which is typically approximated by an MMSE denoiser (`denoiser`) using the well-known Tweedie's formula, while the
second term is approximated by the (noisy) data-fidelity term (`data_fidelity`).
We implement various data-fidelity terms in `the user guide <https://deepinv.github.io/deepinv/user_guide/reconstruction/sampling.html#id2>`_.

.. GENERATED FROM PYTHON SOURCE LINES 43-51

---------------------------------------------------

Let us import the necessary modules, define the denoiser and the SDE.

In this first example, we use the Variance-Exploding SDE, whose forward process is defined as:

.. math::
    d\, x_t = g(t) d\, w_t \quad \mbox{where } g(t) = \sigma_{\mathrm{min}}\left( \frac{\sigma_{\mathrm{max}}}{\sigma_{\mathrm{min}}}\right)^t

.. GENERATED FROM PYTHON SOURCE LINES 51-60

.. code-block:: Python


    import torch
    import deepinv as dinv
    from deepinv.models import NCSNpp

    device = "cuda" if torch.cuda.is_available() else "cpu"
    dtype = torch.float64
    figsize = 2.5
    gif_frequency = 10  # Increase this value to save the GIF saving time







.. GENERATED FROM PYTHON SOURCE LINES 61-92

.. code-block:: Python

    from deepinv.sampling import (
        PosteriorDiffusion,
        DPSDataFidelity,
        EulerSolver,
        VarianceExplodingDiffusion,
    )
    from deepinv.optim import ZeroFidelity

    # In this example, we use the pre-trained FFHQ-64 model from the
    # EDM framework: https://arxiv.org/pdf/2206.00364 .
    # The network architecture is from Song et al: https://arxiv.org/abs/2011.13456 .
    denoiser = NCSNpp(pretrained="download").to(device)

    # The solution is obtained by calling the SDE object with a desired solver (here, Euler).
    # The reproducibility of the SDE Solver class can be controlled by providing the pseudo-random number generator.
    num_steps = 150
    rng = torch.Generator(device).manual_seed(42)
    timesteps = torch.linspace(1, 0.001, num_steps)
    solver = EulerSolver(timesteps=timesteps, rng=rng)


    sigma_min = 0.02
    sigma_max = 20
    sde = VarianceExplodingDiffusion(
        sigma_max=sigma_max,
        sigma_min=sigma_min,
        alpha=0.5,
        device=device,
        dtype=dtype,
    )





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Downloading: "https://huggingface.co/deepinv/edm/resolve/main/ncsnpp-ffhq64-uncond-ve.pt?download=true" to /home/runner/.cache/torch/hub/checkpoints/ncsnpp-ffhq64-uncond-ve.pt
      0%|          | 0.00/240M [00:00<?, ?B/s]      2%|▏         | 4.38M/240M [00:00<00:05, 45.5MB/s]      8%|▊         | 20.0M/240M [00:00<00:02, 115MB/s]      20%|█▉        | 47.1M/240M [00:00<00:01, 192MB/s]     32%|███▏      | 76.1M/240M [00:00<00:00, 236MB/s]     41%|████      | 98.8M/240M [00:00<00:00, 232MB/s]     54%|█████▍    | 129M/240M [00:00<00:00, 260MB/s]      66%|██████▌   | 157M/240M [00:00<00:00, 272MB/s]     79%|███████▊  | 188M/240M [00:00<00:00, 288MB/s]     90%|█████████ | 216M/240M [00:00<00:00, 267MB/s]    100%|██████████| 240M/240M [00:01<00:00, 238MB/s]




.. GENERATED FROM PYTHON SOURCE LINES 93-98

Reverse-time SDE as sampling process
--------------------------------------

When the data fidelity is not given, the posterior diffusion is equivalent to the unconditional diffusion.
Sampling is performed by solving the reverse-time SDE. To do so, we generate a reverse-time trajectory.

.. GENERATED FROM PYTHON SOURCE LINES 98-130

.. code-block:: Python


    model = PosteriorDiffusion(
        data_fidelity=ZeroFidelity(),
        sde=sde,
        denoiser=denoiser,
        solver=solver,
        dtype=dtype,
        device=device,
        verbose=True,
    )
    sample_seed_1, trajectory_seed_1 = model(
        y=None,
        physics=None,
        x_init=(1, 3, 64, 64),
        seed=1,
        get_trajectory=True,
    )
    dinv.utils.plot(
        sample_seed_1,
        titles="Unconditional generation",
        save_fn="sde_sample.png",
        figsize=(figsize, figsize),
    )

    dinv.utils.save_videos(
        trajectory_seed_1.cpu()[::gif_frequency],
        time_dim=0,
        titles=["VE-SDE Trajectory"],
        save_fn="sde_trajectory.gif",
        figsize=(figsize, figsize),
    )





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

      0%|          | 0/149 [00:00<?, ?it/s]      1%|          | 1/149 [00:00<01:23,  1.78it/s]      1%|▏         | 2/149 [00:01<01:21,  1.80it/s]      2%|▏         | 3/149 [00:01<01:20,  1.81it/s]      3%|▎         | 4/149 [00:02<01:19,  1.82it/s]      3%|▎         | 5/149 [00:02<01:18,  1.82it/s]      4%|▍         | 6/149 [00:03<01:18,  1.83it/s]      5%|▍         | 7/149 [00:03<01:17,  1.83it/s]      5%|▌         | 8/149 [00:04<01:16,  1.84it/s]      6%|▌         | 9/149 [00:04<01:16,  1.83it/s]      7%|▋         | 10/149 [00:05<01:15,  1.84it/s]      7%|▋         | 11/149 [00:06<01:15,  1.84it/s]      8%|▊         | 12/149 [00:06<01:14,  1.84it/s]      9%|▊         | 13/149 [00:07<01:14,  1.84it/s]      9%|▉         | 14/149 [00:07<01:13,  1.84it/s]     10%|█         | 15/149 [00:08<01:13,  1.83it/s]     11%|█         | 16/149 [00:08<01:12,  1.84it/s]     11%|█▏        | 17/149 [00:09<01:11,  1.84it/s]     12%|█▏        | 18/149 [00:09<01:11,  1.84it/s]     13%|█▎        | 19/149 [00:10<01:10,  1.84it/s]     13%|█▎        | 20/149 [00:10<01:10,  1.84it/s]     14%|█▍        | 21/149 [00:11<01:09,  1.84it/s]     15%|█▍        | 22/149 [00:12<01:09,  1.83it/s]     15%|█▌        | 23/149 [00:12<01:08,  1.84it/s]     16%|█▌        | 24/149 [00:13<01:08,  1.84it/s]     17%|█▋        | 25/149 [00:13<01:07,  1.84it/s]     17%|█▋        | 26/149 [00:14<01:06,  1.84it/s]     18%|█▊        | 27/149 [00:14<01:06,  1.84it/s]     19%|█▉        | 28/149 [00:15<01:05,  1.83it/s]     19%|█▉        | 29/149 [00:15<01:05,  1.84it/s]     20%|██        | 30/149 [00:16<01:04,  1.83it/s]     21%|██        | 31/149 [00:16<01:04,  1.84it/s]     21%|██▏       | 32/149 [00:17<01:03,  1.84it/s]     22%|██▏       | 33/149 [00:17<01:03,  1.84it/s]     23%|██▎       | 34/149 [00:18<01:02,  1.84it/s]     23%|██▎       | 35/149 [00:19<01:02,  1.84it/s]     24%|██▍       | 36/149 [00:19<01:01,  1.84it/s]     25%|██▍       | 37/149 [00:20<01:00,  1.84it/s]     26%|██▌       | 38/149 [00:20<01:00,  1.84it/s]     26%|██▌       | 39/149 [00:21<00:59,  1.84it/s]     27%|██▋       | 40/149 [00:21<00:59,  1.84it/s]     28%|██▊       | 41/149 [00:22<00:58,  1.83it/s]     28%|██▊       | 42/149 [00:22<00:58,  1.83it/s]     29%|██▉       | 43/149 [00:23<00:57,  1.83it/s]     30%|██▉       | 44/149 [00:23<00:57,  1.83it/s]     30%|███       | 45/149 [00:24<00:56,  1.83it/s]     31%|███       | 46/149 [00:25<00:56,  1.84it/s]     32%|███▏      | 47/149 [00:25<00:55,  1.83it/s]     32%|███▏      | 48/149 [00:26<00:55,  1.84it/s]     33%|███▎      | 49/149 [00:26<00:54,  1.83it/s]     34%|███▎      | 50/149 [00:27<00:53,  1.84it/s]     34%|███▍      | 51/149 [00:27<00:53,  1.83it/s]     35%|███▍      | 52/149 [00:28<00:52,  1.83it/s]     36%|███▌      | 53/149 [00:28<00:52,  1.81it/s]     36%|███▌      | 54/149 [00:29<00:52,  1.82it/s]     37%|███▋      | 55/149 [00:30<00:51,  1.82it/s]     38%|███▊      | 56/149 [00:30<00:51,  1.82it/s]     38%|███▊      | 57/149 [00:31<00:50,  1.83it/s]     39%|███▉      | 58/149 [00:31<00:49,  1.83it/s]     40%|███▉      | 59/149 [00:32<00:49,  1.83it/s]     40%|████      | 60/149 [00:32<00:48,  1.83it/s]     41%|████      | 61/149 [00:33<00:47,  1.83it/s]     42%|████▏     | 62/149 [00:33<00:47,  1.83it/s]     42%|████▏     | 63/149 [00:34<00:46,  1.83it/s]     43%|████▎     | 64/149 [00:34<00:46,  1.83it/s]     44%|████▎     | 65/149 [00:35<00:45,  1.84it/s]     44%|████▍     | 66/149 [00:36<00:45,  1.84it/s]     45%|████▍     | 67/149 [00:36<00:44,  1.84it/s]     46%|████▌     | 68/149 [00:37<00:44,  1.84it/s]     46%|████▋     | 69/149 [00:37<00:43,  1.84it/s]     47%|████▋     | 70/149 [00:38<00:43,  1.83it/s]     48%|████▊     | 71/149 [00:38<00:42,  1.84it/s]     48%|████▊     | 72/149 [00:39<00:41,  1.84it/s]     49%|████▉     | 73/149 [00:39<00:41,  1.84it/s]     50%|████▉     | 74/149 [00:40<00:40,  1.84it/s]     50%|█████     | 75/149 [00:40<00:40,  1.84it/s]     51%|█████     | 76/149 [00:41<00:39,  1.84it/s]     52%|█████▏    | 77/149 [00:41<00:39,  1.84it/s]     52%|█████▏    | 78/149 [00:42<00:38,  1.84it/s]     53%|█████▎    | 79/149 [00:43<00:38,  1.84it/s]     54%|█████▎    | 80/149 [00:43<00:37,  1.84it/s]     54%|█████▍    | 81/149 [00:44<00:37,  1.83it/s]     55%|█████▌    | 82/149 [00:44<00:36,  1.84it/s]     56%|█████▌    | 83/149 [00:45<00:35,  1.84it/s]     56%|█████▋    | 84/149 [00:45<00:35,  1.84it/s]     57%|█████▋    | 85/149 [00:46<00:34,  1.84it/s]     58%|█████▊    | 86/149 [00:46<00:34,  1.84it/s]     58%|█████▊    | 87/149 [00:47<00:33,  1.83it/s]     59%|█████▉    | 88/149 [00:47<00:33,  1.84it/s]     60%|█████▉    | 89/149 [00:48<00:32,  1.84it/s]     60%|██████    | 90/149 [00:49<00:32,  1.84it/s]     61%|██████    | 91/149 [00:49<00:31,  1.84it/s]     62%|██████▏   | 92/149 [00:50<00:31,  1.83it/s]     62%|██████▏   | 93/149 [00:50<00:30,  1.84it/s]     63%|██████▎   | 94/149 [00:51<00:29,  1.84it/s]     64%|██████▍   | 95/149 [00:51<00:29,  1.84it/s]     64%|██████▍   | 96/149 [00:52<00:28,  1.84it/s]     65%|██████▌   | 97/149 [00:52<00:28,  1.84it/s]     66%|██████▌   | 98/149 [00:53<00:27,  1.84it/s]     66%|██████▋   | 99/149 [00:53<00:27,  1.84it/s]     67%|██████▋   | 100/149 [00:54<00:26,  1.84it/s]     68%|██████▊   | 101/149 [00:55<00:26,  1.84it/s]     68%|██████▊   | 102/149 [00:55<00:25,  1.84it/s]     69%|██████▉   | 103/149 [00:56<00:24,  1.84it/s]     70%|██████▉   | 104/149 [00:56<00:24,  1.84it/s]     70%|███████   | 105/149 [00:57<00:23,  1.84it/s]     71%|███████   | 106/149 [00:57<00:23,  1.84it/s]     72%|███████▏  | 107/149 [00:58<00:22,  1.84it/s]     72%|███████▏  | 108/149 [00:58<00:22,  1.84it/s]     73%|███████▎  | 109/149 [00:59<00:21,  1.84it/s]     74%|███████▍  | 110/149 [00:59<00:21,  1.84it/s]     74%|███████▍  | 111/149 [01:00<00:20,  1.84it/s]     75%|███████▌  | 112/149 [01:01<00:20,  1.84it/s]     76%|███████▌  | 113/149 [01:01<00:19,  1.84it/s]     77%|███████▋  | 114/149 [01:02<00:19,  1.84it/s]     77%|███████▋  | 115/149 [01:02<00:18,  1.84it/s]     78%|███████▊  | 116/149 [01:03<00:17,  1.84it/s]     79%|███████▊  | 117/149 [01:03<00:17,  1.84it/s]     79%|███████▉  | 118/149 [01:04<00:16,  1.84it/s]     80%|███████▉  | 119/149 [01:04<00:16,  1.84it/s]     81%|████████  | 120/149 [01:05<00:15,  1.84it/s]     81%|████████  | 121/149 [01:05<00:15,  1.84it/s]     82%|████████▏ | 122/149 [01:06<00:14,  1.84it/s]     83%|████████▎ | 123/149 [01:07<00:14,  1.84it/s]     83%|████████▎ | 124/149 [01:07<00:13,  1.84it/s]     84%|████████▍ | 125/149 [01:08<00:13,  1.84it/s]     85%|████████▍ | 126/149 [01:08<00:12,  1.84it/s]     85%|████████▌ | 127/149 [01:09<00:11,  1.84it/s]     86%|████████▌ | 128/149 [01:09<00:11,  1.84it/s]     87%|████████▋ | 129/149 [01:10<00:10,  1.84it/s]     87%|████████▋ | 130/149 [01:10<00:10,  1.84it/s]     88%|████████▊ | 131/149 [01:11<00:09,  1.84it/s]     89%|████████▊ | 132/149 [01:11<00:09,  1.84it/s]     89%|████████▉ | 133/149 [01:12<00:08,  1.84it/s]     90%|████████▉ | 134/149 [01:13<00:08,  1.84it/s]     91%|█████████ | 135/149 [01:13<00:07,  1.84it/s]     91%|█████████▏| 136/149 [01:14<00:07,  1.84it/s]     92%|█████████▏| 137/149 [01:14<00:06,  1.84it/s]     93%|█████████▎| 138/149 [01:15<00:05,  1.84it/s]     93%|█████████▎| 139/149 [01:15<00:05,  1.84it/s]     94%|█████████▍| 140/149 [01:16<00:04,  1.84it/s]     95%|█████████▍| 141/149 [01:16<00:04,  1.84it/s]     95%|█████████▌| 142/149 [01:17<00:03,  1.84it/s]     96%|█████████▌| 143/149 [01:17<00:03,  1.84it/s]     97%|█████████▋| 144/149 [01:18<00:02,  1.84it/s]     97%|█████████▋| 145/149 [01:18<00:02,  1.84it/s]     98%|█████████▊| 146/149 [01:19<00:01,  1.83it/s]     99%|█████████▊| 147/149 [01:20<00:01,  1.84it/s]     99%|█████████▉| 148/149 [01:20<00:00,  1.84it/s]    100%|██████████| 149/149 [01:21<00:00,  1.84it/s]    100%|██████████| 149/149 [01:21<00:00,  1.84it/s]




.. GENERATED FROM PYTHON SOURCE LINES 148-163

We obtain the following unconditional sample

.. container:: image-row

   .. image-sg-ignore:: /auto_examples/images/sde_sample.png
      :alt: example of unconditional sample
      :srcset: /auto_examples/images/sde_sample.png
      :class: custom-img
      :ignore_missing: true

   .. image-sg-ignore:: /auto_examples/images/sde_trajectory.gif
      :alt: example of unconditional trajectory
      :srcset: /auto_examples/images/sde_trajectory.gif
      :class: custom-gif
      :ignore_missing: true

.. GENERATED FROM PYTHON SOURCE LINES 166-169

When the data fidelity is given, together with the measurements and the physics, this class can be used to perform posterior sampling for inverse problems.
For example, consider the inpainting problem, where we have a noisy image and we want to recover the original image.
We can use the :class:`deepinv.sampling.DPSDataFidelity` as the data fidelity term.

.. GENERATED FROM PYTHON SOURCE LINES 170-211

.. code-block:: Python


    x = sample_seed_1
    physics = dinv.physics.Inpainting(tensor_size=x.shape[1:], mask=0.5, device=device)
    y = physics(x)

    model = PosteriorDiffusion(
        data_fidelity=DPSDataFidelity(denoiser=denoiser),
        denoiser=denoiser,
        sde=sde,
        solver=solver,
        dtype=dtype,
        device=device,
        verbose=True,
    )

    # To perform posterior sampling, we need to provide the measurements, the physics and the solver.
    # Moreover, when the physics is given, the initial point can be inferred from the physics if not given explicitly.
    seed_1 = 11
    x_hat, trajectory = model(
        y,
        physics,
        seed=seed_1,
        get_trajectory=True,
    )
    # Here, we plot the original image, the measurement and the posterior sample
    dinv.utils.plot(
        [x, y, x_hat],
        show=True,
        titles=["Original", "Measurement", "Posterior sample"],
        save_fn="posterior_sample.png",
        figsize=(figsize * 3, figsize),
    )
    # We can also save the trajectory of the posterior sample
    dinv.utils.save_videos(
        trajectory[::gif_frequency],
        time_dim=0,
        titles=["Posterior sample with VE"],
        save_fn="posterior_trajectory.gif",
        figsize=(figsize, figsize),
    )





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

      0%|          | 0/149 [00:00<?, ?it/s]      1%|          | 1/149 [00:01<04:02,  1.64s/it]      1%|▏         | 2/149 [00:03<03:59,  1.63s/it]      2%|▏         | 3/149 [00:04<03:57,  1.63s/it]      3%|▎         | 4/149 [00:06<03:55,  1.62s/it]      3%|▎         | 5/149 [00:08<03:53,  1.62s/it]      4%|▍         | 6/149 [00:09<03:51,  1.62s/it]      5%|▍         | 7/149 [00:11<03:50,  1.62s/it]      5%|▌         | 8/149 [00:12<03:48,  1.62s/it]      6%|▌         | 9/149 [00:14<03:47,  1.62s/it]      7%|▋         | 10/149 [00:16<03:45,  1.62s/it]      7%|▋         | 11/149 [00:17<03:43,  1.62s/it]      8%|▊         | 12/149 [00:19<03:42,  1.62s/it]      9%|▊         | 13/149 [00:21<03:41,  1.63s/it]      9%|▉         | 14/149 [00:22<03:39,  1.63s/it]     10%|█         | 15/149 [00:24<03:38,  1.63s/it]     11%|█         | 16/149 [00:26<03:36,  1.63s/it]     11%|█▏        | 17/149 [00:27<03:34,  1.63s/it]     12%|█▏        | 18/149 [00:29<03:32,  1.62s/it]     13%|█▎        | 19/149 [00:30<03:31,  1.62s/it]     13%|█▎        | 20/149 [00:32<03:29,  1.63s/it]     14%|█▍        | 21/149 [00:34<03:27,  1.62s/it]     15%|█▍        | 22/149 [00:35<03:26,  1.62s/it]     15%|█▌        | 23/149 [00:37<03:24,  1.62s/it]     16%|█▌        | 24/149 [00:38<03:23,  1.62s/it]     17%|█▋        | 25/149 [00:40<03:21,  1.62s/it]     17%|█▋        | 26/149 [00:42<03:19,  1.62s/it]     18%|█▊        | 27/149 [00:43<03:18,  1.62s/it]     19%|█▉        | 28/149 [00:45<03:16,  1.62s/it]     19%|█▉        | 29/149 [00:47<03:14,  1.62s/it]     20%|██        | 30/149 [00:48<03:12,  1.62s/it]     21%|██        | 31/149 [00:50<03:10,  1.62s/it]     21%|██▏       | 32/149 [00:51<03:10,  1.63s/it]     22%|██▏       | 33/149 [00:53<03:08,  1.63s/it]     23%|██▎       | 34/149 [00:55<03:06,  1.62s/it]     23%|██▎       | 35/149 [00:56<03:04,  1.62s/it]     24%|██▍       | 36/149 [00:58<03:03,  1.62s/it]     25%|██▍       | 37/149 [01:00<03:01,  1.62s/it]     26%|██▌       | 38/149 [01:01<02:59,  1.62s/it]     26%|██▌       | 39/149 [01:03<02:57,  1.61s/it]     27%|██▋       | 40/149 [01:04<02:56,  1.62s/it]     28%|██▊       | 41/149 [01:06<02:55,  1.62s/it]     28%|██▊       | 42/149 [01:08<02:53,  1.62s/it]     29%|██▉       | 43/149 [01:09<02:51,  1.62s/it]     30%|██▉       | 44/149 [01:11<02:49,  1.61s/it]     30%|███       | 45/149 [01:13<02:48,  1.62s/it]     31%|███       | 46/149 [01:14<02:46,  1.62s/it]     32%|███▏      | 47/149 [01:16<02:45,  1.62s/it]     32%|███▏      | 48/149 [01:17<02:44,  1.63s/it]     33%|███▎      | 49/149 [01:19<02:43,  1.63s/it]     34%|███▎      | 50/149 [01:21<02:41,  1.63s/it]     34%|███▍      | 51/149 [01:22<02:38,  1.62s/it]     35%|███▍      | 52/149 [01:24<02:37,  1.62s/it]     36%|███▌      | 53/149 [01:25<02:35,  1.62s/it]     36%|███▌      | 54/149 [01:27<02:34,  1.62s/it]     37%|███▋      | 55/149 [01:29<02:32,  1.63s/it]     38%|███▊      | 56/149 [01:30<02:31,  1.63s/it]     38%|███▊      | 57/149 [01:32<02:30,  1.64s/it]     39%|███▉      | 58/149 [01:34<02:28,  1.63s/it]     40%|███▉      | 59/149 [01:35<02:26,  1.63s/it]     40%|████      | 60/149 [01:37<02:25,  1.63s/it]     41%|████      | 61/149 [01:39<02:23,  1.63s/it]     42%|████▏     | 62/149 [01:40<02:21,  1.62s/it]     42%|████▏     | 63/149 [01:42<02:19,  1.62s/it]     43%|████▎     | 64/149 [01:43<02:17,  1.62s/it]     44%|████▎     | 65/149 [01:45<02:15,  1.62s/it]     44%|████▍     | 66/149 [01:47<02:14,  1.61s/it]     45%|████▍     | 67/149 [01:48<02:12,  1.61s/it]     46%|████▌     | 68/149 [01:50<02:10,  1.61s/it]     46%|████▋     | 69/149 [01:51<02:09,  1.62s/it]     47%|████▋     | 70/149 [01:53<02:07,  1.62s/it]     48%|████▊     | 71/149 [01:55<02:06,  1.62s/it]     48%|████▊     | 72/149 [01:56<02:04,  1.62s/it]     49%|████▉     | 73/149 [01:58<02:02,  1.62s/it]     50%|████▉     | 74/149 [02:00<02:01,  1.62s/it]     50%|█████     | 75/149 [02:01<01:59,  1.62s/it]     51%|█████     | 76/149 [02:03<01:57,  1.62s/it]     52%|█████▏    | 77/149 [02:04<01:56,  1.62s/it]     52%|█████▏    | 78/149 [02:06<01:54,  1.62s/it]     53%|█████▎    | 79/149 [02:08<01:53,  1.62s/it]     54%|█████▎    | 80/149 [02:09<01:51,  1.61s/it]     54%|█████▍    | 81/149 [02:11<01:49,  1.61s/it]     55%|█████▌    | 82/149 [02:12<01:47,  1.61s/it]     56%|█████▌    | 83/149 [02:14<01:46,  1.61s/it]     56%|█████▋    | 84/149 [02:16<01:44,  1.61s/it]     57%|█████▋    | 85/149 [02:17<01:42,  1.61s/it]     58%|█████▊    | 86/149 [02:19<01:41,  1.61s/it]     58%|█████▊    | 87/149 [02:21<01:39,  1.61s/it]     59%|█████▉    | 88/149 [02:22<01:38,  1.61s/it]     60%|█████▉    | 89/149 [02:24<01:36,  1.61s/it]     60%|██████    | 90/149 [02:25<01:34,  1.61s/it]     61%|██████    | 91/149 [02:27<01:33,  1.61s/it]     62%|██████▏   | 92/149 [02:29<01:31,  1.61s/it]     62%|██████▏   | 93/149 [02:30<01:30,  1.61s/it]     63%|██████▎   | 94/149 [02:32<01:28,  1.61s/it]     64%|██████▍   | 95/149 [02:33<01:27,  1.62s/it]     64%|██████▍   | 96/149 [02:35<01:25,  1.61s/it]     65%|██████▌   | 97/149 [02:37<01:23,  1.62s/it]     66%|██████▌   | 98/149 [02:38<01:22,  1.62s/it]     66%|██████▋   | 99/149 [02:40<01:20,  1.62s/it]     67%|██████▋   | 100/149 [02:41<01:19,  1.62s/it]     68%|██████▊   | 101/149 [02:43<01:17,  1.62s/it]     68%|██████▊   | 102/149 [02:45<01:16,  1.62s/it]     69%|██████▉   | 103/149 [02:46<01:14,  1.62s/it]     70%|██████▉   | 104/149 [02:48<01:12,  1.62s/it]     70%|███████   | 105/149 [02:50<01:11,  1.61s/it]     71%|███████   | 106/149 [02:51<01:09,  1.62s/it]     72%|███████▏  | 107/149 [02:53<01:08,  1.62s/it]     72%|███████▏  | 108/149 [02:54<01:06,  1.62s/it]     73%|███████▎  | 109/149 [02:56<01:04,  1.62s/it]     74%|███████▍  | 110/149 [02:58<01:03,  1.62s/it]     74%|███████▍  | 111/149 [02:59<01:01,  1.62s/it]     75%|███████▌  | 112/149 [03:01<01:00,  1.63s/it]     76%|███████▌  | 113/149 [03:03<00:58,  1.63s/it]     77%|███████▋  | 114/149 [03:04<00:56,  1.63s/it]     77%|███████▋  | 115/149 [03:06<00:55,  1.62s/it]     78%|███████▊  | 116/149 [03:07<00:53,  1.62s/it]     79%|███████▊  | 117/149 [03:09<00:51,  1.62s/it]     79%|███████▉  | 118/149 [03:11<00:50,  1.62s/it]     80%|███████▉  | 119/149 [03:12<00:48,  1.61s/it]     81%|████████  | 120/149 [03:14<00:46,  1.61s/it]     81%|████████  | 121/149 [03:15<00:45,  1.61s/it]     82%|████████▏ | 122/149 [03:17<00:43,  1.62s/it]     83%|████████▎ | 123/149 [03:19<00:42,  1.62s/it]     83%|████████▎ | 124/149 [03:20<00:40,  1.61s/it]     84%|████████▍ | 125/149 [03:22<00:38,  1.62s/it]     85%|████████▍ | 126/149 [03:24<00:37,  1.62s/it]     85%|████████▌ | 127/149 [03:25<00:35,  1.62s/it]     86%|████████▌ | 128/149 [03:27<00:34,  1.63s/it]     87%|████████▋ | 129/149 [03:28<00:32,  1.63s/it]     87%|████████▋ | 130/149 [03:30<00:30,  1.63s/it]     88%|████████▊ | 131/149 [03:32<00:29,  1.62s/it]     89%|████████▊ | 132/149 [03:33<00:27,  1.62s/it]     89%|████████▉ | 133/149 [03:35<00:25,  1.62s/it]     90%|████████▉ | 134/149 [03:37<00:24,  1.62s/it]     91%|█████████ | 135/149 [03:38<00:22,  1.61s/it]     91%|█████████▏| 136/149 [03:40<00:20,  1.62s/it]     92%|█████████▏| 137/149 [03:41<00:19,  1.61s/it]     93%|█████████▎| 138/149 [03:43<00:17,  1.61s/it]     93%|█████████▎| 139/149 [03:45<00:16,  1.61s/it]     94%|█████████▍| 140/149 [03:46<00:14,  1.61s/it]     95%|█████████▍| 141/149 [03:48<00:12,  1.61s/it]     95%|█████████▌| 142/149 [03:49<00:11,  1.61s/it]     96%|█████████▌| 143/149 [03:51<00:09,  1.62s/it]     97%|█████████▋| 144/149 [03:53<00:08,  1.62s/it]     97%|█████████▋| 145/149 [03:54<00:06,  1.62s/it]     98%|█████████▊| 146/149 [03:56<00:04,  1.61s/it]     99%|█████████▊| 147/149 [03:58<00:03,  1.61s/it]     99%|█████████▉| 148/149 [03:59<00:01,  1.61s/it]    100%|██████████| 149/149 [04:01<00:00,  1.61s/it]    100%|██████████| 149/149 [04:01<00:00,  1.62s/it]




.. GENERATED FROM PYTHON SOURCE LINES 229-243

We obtain the following posterior sample and trajectory

.. container:: image-col

   .. image-sg-ignore:: /auto_examples/images/posterior_sample.png
      :alt: example of posterior sample
      :srcset: /auto_examples/images/posterior_sample.png
      :ignore_missing: true

   .. image-sg-ignore:: /auto_examples/images/posterior_trajectory.gif
      :alt: example of posterior trajectory
      :srcset: /auto_examples/images/posterior_trajectory.gif
      :ignore_missing: true
      :class: custom-gif

.. GENERATED FROM PYTHON SOURCE LINES 246-254

.. note::

    **Reproducibility**: To ensure the reproducibility, if the parameter `rng` is given, the same sample will
    be generated when the same seed is used.
    One can obtain varying samples by using a different seed.

    **Parallel sampling**: one can draw multiple samples in parallel by giving the initial shape, e.g., `x_init = (B, C, H, W)`


.. GENERATED FROM PYTHON SOURCE LINES 256-264

Varying the SDE
---------------

One can also change the underlying SDE for sampling.
For example, we can also use the Variance-Preserving (VP or DDPM) in :class:`deepinv.sampling.VariancePreservingDiffusion`, whose forward drift and diffusion term are defined as:

.. math::
    f(x_t, t) = -\frac{1}{2} \beta(t)x_t \qquad \mbox{ and } \qquad g(t) = \beta(t)  \qquad \mbox{ with } \beta(t) = \beta_{\mathrm{min}}  + t \left( \beta_{\mathrm{max}} - \beta_{\mathrm{min}} \right).

.. GENERATED FROM PYTHON SOURCE LINES 264-305

.. code-block:: Python


    from deepinv.sampling import VariancePreservingDiffusion

    sde = VariancePreservingDiffusion(device=device, dtype=dtype)
    model = PosteriorDiffusion(
        data_fidelity=DPSDataFidelity(denoiser=denoiser),
        denoiser=denoiser,
        sde=sde,
        solver=solver,
        device=device,
        dtype=dtype,
        verbose=True,
    )

    x_hat_vp, trajectory_vp = model(
        y,
        physics,
        seed=111,
        timesteps=torch.linspace(1, 0.001, 300),
        get_trajectory=True,
    )
    dinv.utils.plot(
        [x_hat, x_hat_vp],
        titles=[
            "posterior sample with VE",
            "posterior sample with VP",
        ],
        save_fn="posterior_sample_ve_vp.png",
        figsize=(figsize * 2, figsize),
    )

    # We can also save the trajectory of the posterior sample
    dinv.utils.save_videos(
        trajectory[::gif_frequency],
        time_dim=0,
        titles=["Posterior sample with VP"],
        save_fn="posterior_trajectory_vp.gif",
        figsize=(figsize, figsize),
    )






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

      0%|          | 0/299 [00:00<?, ?it/s]      0%|          | 1/299 [00:01<07:58,  1.61s/it]      1%|          | 2/299 [00:03<07:57,  1.61s/it]      1%|          | 3/299 [00:04<07:55,  1.61s/it]      1%|▏         | 4/299 [00:06<07:54,  1.61s/it]      2%|▏         | 5/299 [00:08<07:53,  1.61s/it]      2%|▏         | 6/299 [00:09<07:51,  1.61s/it]      2%|▏         | 7/299 [00:11<07:49,  1.61s/it]      3%|▎         | 8/299 [00:12<07:47,  1.61s/it]      3%|▎         | 9/299 [00:14<07:46,  1.61s/it]      3%|▎         | 10/299 [00:16<07:44,  1.61s/it]      4%|▎         | 11/299 [00:17<07:42,  1.61s/it]      4%|▍         | 12/299 [00:19<07:40,  1.61s/it]      4%|▍         | 13/299 [00:20<07:40,  1.61s/it]      5%|▍         | 14/299 [00:22<07:37,  1.61s/it]      5%|▌         | 15/299 [00:24<07:36,  1.61s/it]      5%|▌         | 16/299 [00:25<07:34,  1.61s/it]      6%|▌         | 17/299 [00:27<07:32,  1.61s/it]      6%|▌         | 18/299 [00:28<07:31,  1.61s/it]      6%|▋         | 19/299 [00:30<07:29,  1.60s/it]      7%|▋         | 20/299 [00:32<07:27,  1.61s/it]      7%|▋         | 21/299 [00:33<07:26,  1.61s/it]      7%|▋         | 22/299 [00:35<07:24,  1.61s/it]      8%|▊         | 23/299 [00:36<07:22,  1.60s/it]      8%|▊         | 24/299 [00:38<07:21,  1.61s/it]      8%|▊         | 25/299 [00:40<07:21,  1.61s/it]      9%|▊         | 26/299 [00:41<07:19,  1.61s/it]      9%|▉         | 27/299 [00:43<07:17,  1.61s/it]      9%|▉         | 28/299 [00:44<07:15,  1.61s/it]     10%|▉         | 29/299 [00:46<07:14,  1.61s/it]     10%|█         | 30/299 [00:48<07:12,  1.61s/it]     10%|█         | 31/299 [00:49<07:10,  1.61s/it]     11%|█         | 32/299 [00:51<07:09,  1.61s/it]     11%|█         | 33/299 [00:53<07:07,  1.61s/it]     11%|█▏        | 34/299 [00:54<07:05,  1.61s/it]     12%|█▏        | 35/299 [00:56<07:04,  1.61s/it]     12%|█▏        | 36/299 [00:57<07:02,  1.61s/it]     12%|█▏        | 37/299 [00:59<07:00,  1.61s/it]     13%|█▎        | 38/299 [01:01<06:59,  1.61s/it]     13%|█▎        | 39/299 [01:02<06:57,  1.61s/it]     13%|█▎        | 40/299 [01:04<06:55,  1.61s/it]     14%|█▎        | 41/299 [01:05<06:53,  1.60s/it]     14%|█▍        | 42/299 [01:07<06:52,  1.61s/it]     14%|█▍        | 43/299 [01:09<06:50,  1.61s/it]     15%|█▍        | 44/299 [01:10<06:49,  1.61s/it]     15%|█▌        | 45/299 [01:12<06:47,  1.60s/it]     15%|█▌        | 46/299 [01:13<06:46,  1.61s/it]     16%|█▌        | 47/299 [01:15<06:44,  1.61s/it]     16%|█▌        | 48/299 [01:17<06:43,  1.61s/it]     16%|█▋        | 49/299 [01:18<06:41,  1.61s/it]     17%|█▋        | 50/299 [01:20<06:39,  1.61s/it]     17%|█▋        | 51/299 [01:21<06:38,  1.61s/it]     17%|█▋        | 52/299 [01:23<06:36,  1.60s/it]     18%|█▊        | 53/299 [01:25<06:34,  1.61s/it]     18%|█▊        | 54/299 [01:26<06:33,  1.61s/it]     18%|█▊        | 55/299 [01:28<06:32,  1.61s/it]     19%|█▊        | 56/299 [01:29<06:31,  1.61s/it]     19%|█▉        | 57/299 [01:31<06:29,  1.61s/it]     19%|█▉        | 58/299 [01:33<06:28,  1.61s/it]     20%|█▉        | 59/299 [01:34<06:27,  1.62s/it]     20%|██        | 60/299 [01:36<06:25,  1.61s/it]     20%|██        | 61/299 [01:38<06:23,  1.61s/it]     21%|██        | 62/299 [01:39<06:22,  1.62s/it]     21%|██        | 63/299 [01:41<06:20,  1.61s/it]     21%|██▏       | 64/299 [01:42<06:19,  1.61s/it]     22%|██▏       | 65/299 [01:44<06:17,  1.61s/it]     22%|██▏       | 66/299 [01:46<06:14,  1.61s/it]     22%|██▏       | 67/299 [01:47<06:13,  1.61s/it]     23%|██▎       | 68/299 [01:49<06:11,  1.61s/it]     23%|██▎       | 69/299 [01:50<06:09,  1.61s/it]     23%|██▎       | 70/299 [01:52<06:07,  1.61s/it]     24%|██▎       | 71/299 [01:54<06:06,  1.61s/it]     24%|██▍       | 72/299 [01:55<06:04,  1.61s/it]     24%|██▍       | 73/299 [01:57<06:02,  1.61s/it]     25%|██▍       | 74/299 [01:58<06:01,  1.61s/it]     25%|██▌       | 75/299 [02:00<05:59,  1.60s/it]     25%|██▌       | 76/299 [02:02<05:57,  1.60s/it]     26%|██▌       | 77/299 [02:03<05:56,  1.60s/it]     26%|██▌       | 78/299 [02:05<05:54,  1.61s/it]     26%|██▋       | 79/299 [02:06<05:53,  1.60s/it]     27%|██▋       | 80/299 [02:08<05:51,  1.61s/it]     27%|██▋       | 81/299 [02:10<05:49,  1.60s/it]     27%|██▋       | 82/299 [02:11<05:48,  1.61s/it]     28%|██▊       | 83/299 [02:13<05:46,  1.60s/it]     28%|██▊       | 84/299 [02:15<05:45,  1.61s/it]     28%|██▊       | 85/299 [02:16<05:43,  1.61s/it]     29%|██▉       | 86/299 [02:18<05:42,  1.61s/it]     29%|██▉       | 87/299 [02:19<05:40,  1.61s/it]     29%|██▉       | 88/299 [02:21<05:39,  1.61s/it]     30%|██▉       | 89/299 [02:23<05:37,  1.61s/it]     30%|███       | 90/299 [02:24<05:36,  1.61s/it]     30%|███       | 91/299 [02:26<05:34,  1.61s/it]     31%|███       | 92/299 [02:27<05:32,  1.61s/it]     31%|███       | 93/299 [02:29<05:31,  1.61s/it]     31%|███▏      | 94/299 [02:31<05:29,  1.61s/it]     32%|███▏      | 95/299 [02:32<05:28,  1.61s/it]     32%|███▏      | 96/299 [02:34<05:26,  1.61s/it]     32%|███▏      | 97/299 [02:35<05:24,  1.61s/it]     33%|███▎      | 98/299 [02:37<05:22,  1.61s/it]     33%|███▎      | 99/299 [02:39<05:21,  1.61s/it]     33%|███▎      | 100/299 [02:40<05:20,  1.61s/it]     34%|███▍      | 101/299 [02:42<05:18,  1.61s/it]     34%|███▍      | 102/299 [02:43<05:16,  1.61s/it]     34%|███▍      | 103/299 [02:45<05:15,  1.61s/it]     35%|███▍      | 104/299 [02:47<05:13,  1.61s/it]     35%|███▌      | 105/299 [02:48<05:11,  1.61s/it]     35%|███▌      | 106/299 [02:50<05:10,  1.61s/it]     36%|███▌      | 107/299 [02:51<05:08,  1.61s/it]     36%|███▌      | 108/299 [02:53<05:06,  1.61s/it]     36%|███▋      | 109/299 [02:55<05:05,  1.61s/it]     37%|███▋      | 110/299 [02:56<05:03,  1.61s/it]     37%|███▋      | 111/299 [02:58<05:02,  1.61s/it]     37%|███▋      | 112/299 [03:00<05:00,  1.61s/it]     38%|███▊      | 113/299 [03:01<04:58,  1.61s/it]     38%|███▊      | 114/299 [03:03<04:57,  1.61s/it]     38%|███▊      | 115/299 [03:04<04:55,  1.61s/it]     39%|███▉      | 116/299 [03:06<04:53,  1.61s/it]     39%|███▉      | 117/299 [03:08<04:52,  1.61s/it]     39%|███▉      | 118/299 [03:09<04:50,  1.61s/it]     40%|███▉      | 119/299 [03:11<04:48,  1.61s/it]     40%|████      | 120/299 [03:12<04:47,  1.61s/it]     40%|████      | 121/299 [03:14<04:46,  1.61s/it]     41%|████      | 122/299 [03:16<04:44,  1.61s/it]     41%|████      | 123/299 [03:17<04:42,  1.61s/it]     41%|████▏     | 124/299 [03:19<04:41,  1.61s/it]     42%|████▏     | 125/299 [03:20<04:39,  1.61s/it]     42%|████▏     | 126/299 [03:22<04:38,  1.61s/it]     42%|████▏     | 127/299 [03:24<04:36,  1.61s/it]     43%|████▎     | 128/299 [03:25<04:34,  1.60s/it]     43%|████▎     | 129/299 [03:27<04:32,  1.60s/it]     43%|████▎     | 130/299 [03:28<04:30,  1.60s/it]     44%|████▍     | 131/299 [03:30<04:29,  1.60s/it]     44%|████▍     | 132/299 [03:32<04:27,  1.60s/it]     44%|████▍     | 133/299 [03:33<04:25,  1.60s/it]     45%|████▍     | 134/299 [03:35<04:24,  1.60s/it]     45%|████▌     | 135/299 [03:36<04:22,  1.60s/it]     45%|████▌     | 136/299 [03:38<04:21,  1.60s/it]     46%|████▌     | 137/299 [03:40<04:20,  1.61s/it]     46%|████▌     | 138/299 [03:41<04:18,  1.61s/it]     46%|████▋     | 139/299 [03:43<04:16,  1.60s/it]     47%|████▋     | 140/299 [03:44<04:15,  1.61s/it]     47%|████▋     | 141/299 [03:46<04:13,  1.61s/it]     47%|████▋     | 142/299 [03:48<04:11,  1.60s/it]     48%|████▊     | 143/299 [03:49<04:10,  1.60s/it]     48%|████▊     | 144/299 [03:51<04:08,  1.60s/it]     48%|████▊     | 145/299 [03:52<04:06,  1.60s/it]     49%|████▉     | 146/299 [03:54<04:05,  1.60s/it]     49%|████▉     | 147/299 [03:56<04:03,  1.60s/it]     49%|████▉     | 148/299 [03:57<04:02,  1.60s/it]     50%|████▉     | 149/299 [03:59<04:00,  1.60s/it]     50%|█████     | 150/299 [04:01<03:59,  1.60s/it]     51%|█████     | 151/299 [04:02<03:57,  1.60s/it]     51%|█████     | 152/299 [04:04<03:55,  1.61s/it]     51%|█████     | 153/299 [04:05<03:54,  1.60s/it]     52%|█████▏    | 154/299 [04:07<03:52,  1.60s/it]     52%|█████▏    | 155/299 [04:09<03:50,  1.60s/it]     52%|█████▏    | 156/299 [04:10<03:49,  1.61s/it]     53%|█████▎    | 157/299 [04:12<03:47,  1.60s/it]     53%|█████▎    | 158/299 [04:13<03:46,  1.60s/it]     53%|█████▎    | 159/299 [04:15<03:44,  1.60s/it]     54%|█████▎    | 160/299 [04:17<03:43,  1.61s/it]     54%|█████▍    | 161/299 [04:18<03:41,  1.61s/it]     54%|█████▍    | 162/299 [04:20<03:40,  1.61s/it]     55%|█████▍    | 163/299 [04:21<03:39,  1.61s/it]     55%|█████▍    | 164/299 [04:23<03:37,  1.61s/it]     55%|█████▌    | 165/299 [04:25<03:35,  1.61s/it]     56%|█████▌    | 166/299 [04:26<03:34,  1.61s/it]     56%|█████▌    | 167/299 [04:28<03:33,  1.61s/it]     56%|█████▌    | 168/299 [04:29<03:31,  1.61s/it]     57%|█████▋    | 169/299 [04:31<03:29,  1.61s/it]     57%|█████▋    | 170/299 [04:33<03:28,  1.61s/it]     57%|█████▋    | 171/299 [04:34<03:26,  1.61s/it]     58%|█████▊    | 172/299 [04:36<03:24,  1.61s/it]     58%|█████▊    | 173/299 [04:38<03:23,  1.61s/it]     58%|█████▊    | 174/299 [04:39<03:22,  1.62s/it]     59%|█████▊    | 175/299 [04:41<03:20,  1.61s/it]     59%|█████▉    | 176/299 [04:42<03:18,  1.61s/it]     59%|█████▉    | 177/299 [04:44<03:17,  1.62s/it]     60%|█████▉    | 178/299 [04:46<03:15,  1.61s/it]     60%|█████▉    | 179/299 [04:47<03:13,  1.61s/it]     60%|██████    | 180/299 [04:49<03:11,  1.61s/it]     61%|██████    | 181/299 [04:50<03:09,  1.61s/it]     61%|██████    | 182/299 [04:52<03:08,  1.61s/it]     61%|██████    | 183/299 [04:54<03:06,  1.61s/it]     62%|██████▏   | 184/299 [04:55<03:05,  1.61s/it]     62%|██████▏   | 185/299 [04:57<03:03,  1.61s/it]     62%|██████▏   | 186/299 [04:58<03:02,  1.62s/it]     63%|██████▎   | 187/299 [05:00<03:01,  1.62s/it]     63%|██████▎   | 188/299 [05:02<02:59,  1.62s/it]     63%|██████▎   | 189/299 [05:03<02:57,  1.61s/it]     64%|██████▎   | 190/299 [05:05<02:55,  1.61s/it]     64%|██████▍   | 191/299 [05:07<02:54,  1.61s/it]     64%|██████▍   | 192/299 [05:08<02:52,  1.61s/it]     65%|██████▍   | 193/299 [05:10<02:50,  1.61s/it]     65%|██████▍   | 194/299 [05:11<02:49,  1.61s/it]     65%|██████▌   | 195/299 [05:13<02:47,  1.61s/it]     66%|██████▌   | 196/299 [05:15<02:45,  1.61s/it]     66%|██████▌   | 197/299 [05:16<02:44,  1.62s/it]     66%|██████▌   | 198/299 [05:18<02:43,  1.62s/it]     67%|██████▋   | 199/299 [05:19<02:41,  1.62s/it]     67%|██████▋   | 200/299 [05:21<02:39,  1.61s/it]     67%|██████▋   | 201/299 [05:23<02:38,  1.61s/it]     68%|██████▊   | 202/299 [05:24<02:36,  1.61s/it]     68%|██████▊   | 203/299 [05:26<02:34,  1.61s/it]     68%|██████▊   | 204/299 [05:28<02:32,  1.61s/it]     69%|██████▊   | 205/299 [05:29<02:31,  1.61s/it]     69%|██████▉   | 206/299 [05:31<02:29,  1.61s/it]     69%|██████▉   | 207/299 [05:32<02:27,  1.61s/it]     70%|██████▉   | 208/299 [05:34<02:26,  1.61s/it]     70%|██████▉   | 209/299 [05:36<02:24,  1.61s/it]     70%|███████   | 210/299 [05:37<02:23,  1.61s/it]     71%|███████   | 211/299 [05:39<02:22,  1.62s/it]     71%|███████   | 212/299 [05:40<02:20,  1.61s/it]     71%|███████   | 213/299 [05:42<02:18,  1.61s/it]     72%|███████▏  | 214/299 [05:44<02:17,  1.61s/it]     72%|███████▏  | 215/299 [05:45<02:15,  1.61s/it]     72%|███████▏  | 216/299 [05:47<02:13,  1.61s/it]     73%|███████▎  | 217/299 [05:48<02:12,  1.61s/it]     73%|███████▎  | 218/299 [05:50<02:10,  1.61s/it]     73%|███████▎  | 219/299 [05:52<02:08,  1.61s/it]     74%|███████▎  | 220/299 [05:53<02:06,  1.61s/it]     74%|███████▍  | 221/299 [05:55<02:05,  1.61s/it]     74%|███████▍  | 222/299 [05:56<02:03,  1.61s/it]     75%|███████▍  | 223/299 [05:58<02:02,  1.61s/it]     75%|███████▍  | 224/299 [06:00<02:00,  1.61s/it]     75%|███████▌  | 225/299 [06:01<01:58,  1.61s/it]     76%|███████▌  | 226/299 [06:03<01:57,  1.61s/it]     76%|███████▌  | 227/299 [06:05<01:55,  1.61s/it]     76%|███████▋  | 228/299 [06:06<01:54,  1.61s/it]     77%|███████▋  | 229/299 [06:08<01:52,  1.61s/it]     77%|███████▋  | 230/299 [06:09<01:50,  1.61s/it]     77%|███████▋  | 231/299 [06:11<01:49,  1.60s/it]     78%|███████▊  | 232/299 [06:13<01:47,  1.60s/it]     78%|███████▊  | 233/299 [06:14<01:45,  1.61s/it]     78%|███████▊  | 234/299 [06:16<01:44,  1.60s/it]     79%|███████▊  | 235/299 [06:17<01:42,  1.61s/it]     79%|███████▉  | 236/299 [06:19<01:41,  1.61s/it]     79%|███████▉  | 237/299 [06:21<01:39,  1.61s/it]     80%|███████▉  | 238/299 [06:22<01:37,  1.61s/it]     80%|███████▉  | 239/299 [06:24<01:36,  1.60s/it]     80%|████████  | 240/299 [06:25<01:34,  1.60s/it]     81%|████████  | 241/299 [06:27<01:33,  1.61s/it]     81%|████████  | 242/299 [06:29<01:31,  1.61s/it]     81%|████████▏ | 243/299 [06:30<01:29,  1.61s/it]     82%|████████▏ | 244/299 [06:32<01:28,  1.61s/it]     82%|████████▏ | 245/299 [06:33<01:26,  1.61s/it]     82%|████████▏ | 246/299 [06:35<01:25,  1.61s/it]     83%|████████▎ | 247/299 [06:37<01:23,  1.61s/it]     83%|████████▎ | 248/299 [06:38<01:21,  1.61s/it]     83%|████████▎ | 249/299 [06:40<01:21,  1.63s/it]     84%|████████▎ | 250/299 [06:42<01:19,  1.62s/it]     84%|████████▍ | 251/299 [06:43<01:17,  1.62s/it]     84%|████████▍ | 252/299 [06:45<01:15,  1.61s/it]     85%|████████▍ | 253/299 [06:46<01:14,  1.61s/it]     85%|████████▍ | 254/299 [06:48<01:12,  1.61s/it]     85%|████████▌ | 255/299 [06:50<01:10,  1.61s/it]     86%|████████▌ | 256/299 [06:51<01:09,  1.61s/it]     86%|████████▌ | 257/299 [06:53<01:07,  1.61s/it]     86%|████████▋ | 258/299 [06:54<01:05,  1.61s/it]     87%|████████▋ | 259/299 [06:56<01:04,  1.61s/it]     87%|████████▋ | 260/299 [06:58<01:02,  1.61s/it]     87%|████████▋ | 261/299 [06:59<01:00,  1.61s/it]     88%|████████▊ | 262/299 [07:01<00:59,  1.61s/it]     88%|████████▊ | 263/299 [07:02<00:57,  1.61s/it]     88%|████████▊ | 264/299 [07:04<00:56,  1.61s/it]     89%|████████▊ | 265/299 [07:06<00:54,  1.61s/it]     89%|████████▉ | 266/299 [07:07<00:53,  1.61s/it]     89%|████████▉ | 267/299 [07:09<00:51,  1.62s/it]     90%|████████▉ | 268/299 [07:10<00:50,  1.61s/it]     90%|████████▉ | 269/299 [07:12<00:48,  1.61s/it]     90%|█████████ | 270/299 [07:14<00:46,  1.61s/it]     91%|█████████ | 271/299 [07:15<00:45,  1.61s/it]     91%|█████████ | 272/299 [07:17<00:43,  1.61s/it]     91%|█████████▏| 273/299 [07:19<00:41,  1.61s/it]     92%|█████████▏| 274/299 [07:20<00:40,  1.61s/it]     92%|█████████▏| 275/299 [07:22<00:38,  1.61s/it]     92%|█████████▏| 276/299 [07:23<00:37,  1.61s/it]     93%|█████████▎| 277/299 [07:25<00:35,  1.61s/it]     93%|█████████▎| 278/299 [07:27<00:33,  1.61s/it]     93%|█████████▎| 279/299 [07:28<00:32,  1.61s/it]     94%|█████████▎| 280/299 [07:30<00:30,  1.61s/it]     94%|█████████▍| 281/299 [07:31<00:28,  1.61s/it]     94%|█████████▍| 282/299 [07:33<00:27,  1.61s/it]     95%|█████████▍| 283/299 [07:35<00:25,  1.61s/it]     95%|█████████▍| 284/299 [07:36<00:24,  1.61s/it]     95%|█████████▌| 285/299 [07:38<00:22,  1.61s/it]     96%|█████████▌| 286/299 [07:39<00:21,  1.62s/it]     96%|█████████▌| 287/299 [07:41<00:19,  1.61s/it]     96%|█████████▋| 288/299 [07:43<00:17,  1.61s/it]     97%|█████████▋| 289/299 [07:44<00:16,  1.61s/it]     97%|█████████▋| 290/299 [07:46<00:14,  1.61s/it]     97%|█████████▋| 291/299 [07:48<00:12,  1.61s/it]     98%|█████████▊| 292/299 [07:49<00:11,  1.61s/it]     98%|█████████▊| 293/299 [07:51<00:09,  1.61s/it]     98%|█████████▊| 294/299 [07:52<00:08,  1.61s/it]     99%|█████████▊| 295/299 [07:54<00:06,  1.61s/it]     99%|█████████▉| 296/299 [07:56<00:04,  1.61s/it]     99%|█████████▉| 297/299 [07:57<00:03,  1.61s/it]    100%|█████████▉| 298/299 [07:59<00:01,  1.61s/it]    100%|██████████| 299/299 [08:00<00:00,  1.61s/it]    100%|██████████| 299/299 [08:00<00:00,  1.61s/it]




.. GENERATED FROM PYTHON SOURCE LINES 326-347

We can comparing the sampling trajectory depending on the underlying SDE

.. container:: image-col

   .. image-sg-ignore:: /auto_examples/images/posterior_sample_ve_vp.png
      :alt: posterior sample with VP
      :srcset: /auto_examples/images/posterior_sample_ve_vp.png
      :ignore_missing: true
   .. container:: image-row

      .. image-sg-ignore:: /auto_examples/images/posterior_trajectory.gif
          :alt: posterior trajectory with VE
          :srcset: /auto_examples/images/posterior_trajectory.gif
          :ignore_missing: true
          :class: custom-gif

      .. image-sg-ignore:: /auto_examples/images/posterior_trajectory_vp.gif
          :alt: posterior trajectory with VP
          :srcset: /auto_examples/images/posterior_trajectory_vp.gif
          :ignore_missing: true
          :class: custom-gif

.. GENERATED FROM PYTHON SOURCE LINES 349-355

Plug-and-play Posterior Sampling with arbitrary denoisers
---------------------------------------------------------

The :class:`deepinv.sampling.PosteriorDiffusion` class can be used together with any (well-trained) denoisers for posterior sampling.
For example, we can use the :class:`deepinv.models.DRUNet` for posterior sampling.
We can also change the underlying SDE, for example change the `sigma_max` value.

.. GENERATED FROM PYTHON SOURCE LINES 355-415

.. code-block:: Python


    sigma_min = 0.02
    sigma_max = 7.0
    rng = torch.Generator(device)
    dtype = torch.float32
    timesteps = torch.linspace(1, 0.001, 300)
    solver = EulerSolver(timesteps=timesteps, rng=rng)
    denoiser = dinv.models.DRUNet(pretrained="download").to(device)

    sde = VarianceExplodingDiffusion(
        sigma_max=sigma_max, sigma_min=sigma_min, alpha=0.75, device=device, dtype=dtype
    )
    x = dinv.utils.load_url_image(
        dinv.utils.demo.get_image_url("butterfly.png"), img_size=256, resize_mode="resize"
    ).to(device)

    mask = torch.ones_like(x)
    mask[..., 100:150, 125:175] = 0.0
    physics = dinv.physics.Inpainting(
        mask=mask,
        tensor_size=x.shape[1:],
        device=device,
    )

    y = physics(x)
    model = PosteriorDiffusion(
        data_fidelity=DPSDataFidelity(denoiser=denoiser),
        denoiser=denoiser,
        sde=sde,
        solver=solver,
        dtype=dtype,
        device=device,
        verbose=True,
    )

    # To perform posterior sampling, we need to provide the measurements, the physics and the solver.
    x_hat, trajectory = model(
        y=y,
        physics=physics,
        seed=12,
        get_trajectory=True,
    )
    # Here, we plot the original image, the measurement and the posterior sample
    dinv.utils.plot(
        [x, y, x_hat.clip(0, 1)],
        titles=["Original", "Measurement", "Posterior sample DRUNet"],
        figsize=(figsize * 3, figsize),
        save_fn="posterior_sample_DRUNet.png",
    )

    # We can also save the trajectory of the posterior sample
    dinv.utils.save_videos(
        trajectory[::gif_frequency].clip(0, 1),
        time_dim=0,
        titles=["Posterior trajectory DRUNet"],
        save_fn="posterior_sample_DRUNet.gif",
        figsize=(figsize, figsize),
    )






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

      0%|          | 0/299 [00:00<?, ?it/s]      0%|          | 1/299 [00:05<25:04,  5.05s/it]      1%|          | 2/299 [00:10<24:48,  5.01s/it]      1%|          | 3/299 [00:14<24:36,  4.99s/it]      1%|▏         | 4/299 [00:19<24:29,  4.98s/it]      2%|▏         | 5/299 [00:24<24:23,  4.98s/it]      2%|▏         | 6/299 [00:29<24:20,  4.99s/it]      2%|▏         | 7/299 [00:34<24:16,  4.99s/it]      3%|▎         | 8/299 [00:39<24:10,  4.98s/it]      3%|▎         | 9/299 [00:44<24:05,  4.98s/it]      3%|▎         | 10/299 [00:49<23:59,  4.98s/it]      4%|▎         | 11/299 [00:54<23:52,  4.98s/it]      4%|▍         | 12/299 [00:59<23:46,  4.97s/it]      4%|▍         | 13/299 [01:04<23:42,  4.97s/it]      5%|▍         | 14/299 [01:09<23:37,  4.97s/it]      5%|▌         | 15/299 [01:14<23:31,  4.97s/it]      5%|▌         | 16/299 [01:19<23:28,  4.98s/it]      6%|▌         | 17/299 [01:24<23:24,  4.98s/it]      6%|▌         | 18/299 [01:29<23:21,  4.99s/it]      6%|▋         | 19/299 [01:34<23:15,  4.99s/it]      7%|▋         | 20/299 [01:39<23:10,  4.98s/it]      7%|▋         | 21/299 [01:44<23:06,  4.99s/it]      7%|▋         | 22/299 [01:49<23:01,  4.99s/it]      8%|▊         | 23/299 [01:54<22:57,  4.99s/it]      8%|▊         | 24/299 [01:59<22:50,  4.98s/it]      8%|▊         | 25/299 [02:04<22:43,  4.98s/it]      9%|▊         | 26/299 [02:09<22:38,  4.98s/it]      9%|▉         | 27/299 [02:14<22:33,  4.97s/it]      9%|▉         | 28/299 [02:19<22:28,  4.97s/it]     10%|▉         | 29/299 [02:24<22:25,  4.98s/it]     10%|█         | 30/299 [02:29<22:23,  4.99s/it]     10%|█         | 31/299 [02:34<22:19,  5.00s/it]     11%|█         | 32/299 [02:39<22:15,  5.00s/it]     11%|█         | 33/299 [02:44<22:10,  5.00s/it]     11%|█▏        | 34/299 [02:49<22:05,  5.00s/it]     12%|█▏        | 35/299 [02:54<22:00,  5.00s/it]     12%|█▏        | 36/299 [02:59<21:54,  5.00s/it]     12%|█▏        | 37/299 [03:04<21:49,  5.00s/it]     13%|█▎        | 38/299 [03:09<21:45,  5.00s/it]     13%|█▎        | 39/299 [03:14<21:39,  5.00s/it]     13%|█▎        | 40/299 [03:19<21:34,  5.00s/it]     14%|█▎        | 41/299 [03:24<21:29,  5.00s/it]     14%|█▍        | 42/299 [03:29<21:25,  5.00s/it]     14%|█▍        | 43/299 [03:34<21:20,  5.00s/it]     15%|█▍        | 44/299 [03:39<21:15,  5.00s/it]     15%|█▌        | 45/299 [03:44<21:09,  5.00s/it]     15%|█▌        | 46/299 [03:49<21:03,  4.99s/it]     16%|█▌        | 47/299 [03:54<20:59,  5.00s/it]     16%|█▌        | 48/299 [03:59<20:51,  4.99s/it]     16%|█▋        | 49/299 [04:04<20:44,  4.98s/it]     17%|█▋        | 50/299 [04:09<20:42,  4.99s/it]     17%|█▋        | 51/299 [04:14<20:35,  4.98s/it]     17%|█▋        | 52/299 [04:19<20:29,  4.98s/it]     18%|█▊        | 53/299 [04:24<20:23,  4.97s/it]     18%|█▊        | 54/299 [04:29<20:16,  4.97s/it]     18%|█▊        | 55/299 [04:34<20:11,  4.96s/it]     19%|█▊        | 56/299 [04:39<20:05,  4.96s/it]     19%|█▉        | 57/299 [04:44<19:59,  4.96s/it]     19%|█▉        | 58/299 [04:49<19:54,  4.96s/it]     20%|█▉        | 59/299 [04:54<19:49,  4.96s/it]     20%|██        | 60/299 [04:59<19:45,  4.96s/it]     20%|██        | 61/299 [05:03<19:40,  4.96s/it]     21%|██        | 62/299 [05:08<19:35,  4.96s/it]     21%|██        | 63/299 [05:13<19:31,  4.97s/it]     21%|██▏       | 64/299 [05:18<19:26,  4.96s/it]     22%|██▏       | 65/299 [05:23<19:20,  4.96s/it]     22%|██▏       | 66/299 [05:28<19:16,  4.96s/it]     22%|██▏       | 67/299 [05:33<19:10,  4.96s/it]     23%|██▎       | 68/299 [05:38<19:05,  4.96s/it]     23%|██▎       | 69/299 [05:43<18:59,  4.96s/it]     23%|██▎       | 70/299 [05:48<18:54,  4.95s/it]     24%|██▎       | 71/299 [05:53<18:50,  4.96s/it]     24%|██▍       | 72/299 [05:58<18:45,  4.96s/it]     24%|██▍       | 73/299 [06:03<18:39,  4.95s/it]     25%|██▍       | 74/299 [06:08<18:34,  4.95s/it]     25%|██▌       | 75/299 [06:13<18:29,  4.95s/it]     25%|██▌       | 76/299 [06:18<18:25,  4.96s/it]     26%|██▌       | 77/299 [06:23<18:20,  4.96s/it]     26%|██▌       | 78/299 [06:28<18:18,  4.97s/it]     26%|██▋       | 79/299 [06:33<18:12,  4.97s/it]     27%|██▋       | 80/299 [06:38<18:08,  4.97s/it]     27%|██▋       | 81/299 [06:43<18:02,  4.97s/it]     27%|██▋       | 82/299 [06:48<17:56,  4.96s/it]     28%|██▊       | 83/299 [06:53<17:51,  4.96s/it]     28%|██▊       | 84/299 [06:58<17:45,  4.96s/it]     28%|██▊       | 85/299 [07:03<17:40,  4.96s/it]     29%|██▉       | 86/299 [07:07<17:35,  4.95s/it]     29%|██▉       | 87/299 [07:12<17:30,  4.95s/it]     29%|██▉       | 88/299 [07:17<17:24,  4.95s/it]     30%|██▉       | 89/299 [07:22<17:19,  4.95s/it]     30%|███       | 90/299 [07:27<17:15,  4.96s/it]     30%|███       | 91/299 [07:32<17:09,  4.95s/it]     31%|███       | 92/299 [07:37<17:05,  4.95s/it]     31%|███       | 93/299 [07:42<17:00,  4.95s/it]     31%|███▏      | 94/299 [07:47<16:54,  4.95s/it]     32%|███▏      | 95/299 [07:52<16:49,  4.95s/it]     32%|███▏      | 96/299 [07:57<16:44,  4.95s/it]     32%|███▏      | 97/299 [08:02<16:40,  4.95s/it]     33%|███▎      | 98/299 [08:07<16:35,  4.95s/it]     33%|███▎      | 99/299 [08:12<16:30,  4.95s/it]     33%|███▎      | 100/299 [08:17<16:25,  4.95s/it]     34%|███▍      | 101/299 [08:22<16:20,  4.95s/it]     34%|███▍      | 102/299 [08:27<16:15,  4.95s/it]     34%|███▍      | 103/299 [08:32<16:11,  4.96s/it]     35%|███▍      | 104/299 [08:37<16:06,  4.96s/it]     35%|███▌      | 105/299 [08:42<16:01,  4.95s/it]     35%|███▌      | 106/299 [08:47<15:56,  4.95s/it]     36%|███▌      | 107/299 [08:51<15:50,  4.95s/it]     36%|███▌      | 108/299 [08:56<15:46,  4.96s/it]     36%|███▋      | 109/299 [09:01<15:41,  4.96s/it]     37%|███▋      | 110/299 [09:06<15:37,  4.96s/it]     37%|███▋      | 111/299 [09:11<15:32,  4.96s/it]     37%|███▋      | 112/299 [09:16<15:28,  4.96s/it]     38%|███▊      | 113/299 [09:21<15:23,  4.97s/it]     38%|███▊      | 114/299 [09:26<15:19,  4.97s/it]     38%|███▊      | 115/299 [09:31<15:15,  4.97s/it]     39%|███▉      | 116/299 [09:36<15:10,  4.97s/it]     39%|███▉      | 117/299 [09:41<15:05,  4.97s/it]     39%|███▉      | 118/299 [09:46<14:59,  4.97s/it]     40%|███▉      | 119/299 [09:51<14:53,  4.97s/it]     40%|████      | 120/299 [09:56<14:49,  4.97s/it]     40%|████      | 121/299 [10:01<14:44,  4.97s/it]     41%|████      | 122/299 [10:06<14:38,  4.96s/it]     41%|████      | 123/299 [10:11<14:33,  4.96s/it]     41%|████▏     | 124/299 [10:16<14:28,  4.96s/it]     42%|████▏     | 125/299 [10:21<14:22,  4.96s/it]     42%|████▏     | 126/299 [10:26<14:17,  4.96s/it]     42%|████▏     | 127/299 [10:31<14:13,  4.96s/it]     43%|████▎     | 128/299 [10:36<14:10,  4.97s/it]     43%|████▎     | 129/299 [10:41<14:04,  4.97s/it]     43%|████▎     | 130/299 [10:46<13:58,  4.96s/it]     44%|████▍     | 131/299 [10:51<13:53,  4.96s/it]     44%|████▍     | 132/299 [10:56<13:47,  4.96s/it]     44%|████▍     | 133/299 [11:01<13:42,  4.96s/it]     45%|████▍     | 134/299 [11:05<13:38,  4.96s/it]     45%|████▌     | 135/299 [11:10<13:34,  4.96s/it]     45%|████▌     | 136/299 [11:15<13:30,  4.97s/it]     46%|████▌     | 137/299 [11:20<13:25,  4.97s/it]     46%|████▌     | 138/299 [11:25<13:21,  4.98s/it]     46%|████▋     | 139/299 [11:30<13:16,  4.98s/it]     47%|████▋     | 140/299 [11:35<13:10,  4.97s/it]     47%|████▋     | 141/299 [11:40<13:05,  4.97s/it]     47%|████▋     | 142/299 [11:45<13:00,  4.97s/it]     48%|████▊     | 143/299 [11:50<12:54,  4.97s/it]     48%|████▊     | 144/299 [11:55<12:49,  4.97s/it]     48%|████▊     | 145/299 [12:00<12:44,  4.96s/it]     49%|████▉     | 146/299 [12:05<12:39,  4.96s/it]     49%|████▉     | 147/299 [12:10<12:35,  4.97s/it]     49%|████▉     | 148/299 [12:15<12:30,  4.97s/it]     50%|████▉     | 149/299 [12:20<12:25,  4.97s/it]     50%|█████     | 150/299 [12:25<12:20,  4.97s/it]     51%|█████     | 151/299 [12:30<12:14,  4.96s/it]     51%|█████     | 152/299 [12:35<12:09,  4.96s/it]     51%|█████     | 153/299 [12:40<12:04,  4.97s/it]     52%|█████▏    | 154/299 [12:45<11:59,  4.96s/it]     52%|█████▏    | 155/299 [12:50<11:56,  4.97s/it]     52%|█████▏    | 156/299 [12:55<11:51,  4.98s/it]     53%|█████▎    | 157/299 [13:00<11:46,  4.97s/it]     53%|█████▎    | 158/299 [13:05<11:41,  4.98s/it]     53%|█████▎    | 159/299 [13:10<11:37,  4.98s/it]     54%|█████▎    | 160/299 [13:15<11:32,  4.98s/it]     54%|█████▍    | 161/299 [13:20<11:27,  4.98s/it]     54%|█████▍    | 162/299 [13:25<11:22,  4.99s/it]     55%|█████▍    | 163/299 [13:30<11:18,  4.99s/it]     55%|█████▍    | 164/299 [13:35<11:13,  4.99s/it]     55%|█████▌    | 165/299 [13:40<11:08,  4.99s/it]     56%|█████▌    | 166/299 [13:45<11:04,  4.99s/it]     56%|█████▌    | 167/299 [13:50<10:59,  4.99s/it]     56%|█████▌    | 168/299 [13:55<10:54,  4.99s/it]     57%|█████▋    | 169/299 [14:00<10:49,  5.00s/it]     57%|█████▋    | 170/299 [14:05<10:45,  5.00s/it]     57%|█████▋    | 171/299 [14:10<10:40,  5.01s/it]     58%|█████▊    | 172/299 [14:15<10:35,  5.00s/it]     58%|█████▊    | 173/299 [14:20<10:30,  5.00s/it]     58%|█████▊    | 174/299 [14:25<10:24,  5.00s/it]     59%|█████▊    | 175/299 [14:30<10:20,  5.00s/it]     59%|█████▉    | 176/299 [14:35<10:14,  4.99s/it]     59%|█████▉    | 177/299 [14:40<10:08,  4.99s/it]     60%|█████▉    | 178/299 [14:45<10:03,  4.99s/it]     60%|█████▉    | 179/299 [14:50<09:57,  4.98s/it]     60%|██████    | 180/299 [14:55<09:52,  4.98s/it]     61%|██████    | 181/299 [15:00<09:46,  4.97s/it]     61%|██████    | 182/299 [15:05<09:43,  4.98s/it]     61%|██████    | 183/299 [15:10<09:39,  4.99s/it]     62%|██████▏   | 184/299 [15:15<09:34,  5.00s/it]     62%|██████▏   | 185/299 [15:20<09:29,  4.99s/it]     62%|██████▏   | 186/299 [15:25<09:24,  5.00s/it]     63%|██████▎   | 187/299 [15:30<09:18,  4.99s/it]     63%|██████▎   | 188/299 [15:35<09:13,  4.99s/it]     63%|██████▎   | 189/299 [15:40<09:08,  4.98s/it]     64%|██████▎   | 190/299 [15:45<09:03,  4.98s/it]     64%|██████▍   | 191/299 [15:50<08:59,  4.99s/it]     64%|██████▍   | 192/299 [15:55<08:54,  4.99s/it]     65%|██████▍   | 193/299 [15:59<08:48,  4.99s/it]     65%|██████▍   | 194/299 [16:04<08:44,  4.99s/it]     65%|██████▌   | 195/299 [16:10<08:39,  5.00s/it]     66%|██████▌   | 196/299 [16:14<08:34,  4.99s/it]     66%|██████▌   | 197/299 [16:19<08:29,  4.99s/it]     66%|██████▌   | 198/299 [16:24<08:24,  4.99s/it]     67%|██████▋   | 199/299 [16:29<08:19,  4.99s/it]     67%|██████▋   | 200/299 [16:34<08:13,  4.98s/it]     67%|██████▋   | 201/299 [16:39<08:08,  4.98s/it]     68%|██████▊   | 202/299 [16:44<08:02,  4.98s/it]     68%|██████▊   | 203/299 [16:49<07:57,  4.98s/it]     68%|██████▊   | 204/299 [16:54<07:52,  4.98s/it]     69%|██████▊   | 205/299 [16:59<07:47,  4.98s/it]     69%|██████▉   | 206/299 [17:04<07:42,  4.97s/it]     69%|██████▉   | 207/299 [17:09<07:37,  4.97s/it]     70%|██████▉   | 208/299 [17:14<07:32,  4.98s/it]     70%|██████▉   | 209/299 [17:19<07:27,  4.98s/it]     70%|███████   | 210/299 [17:24<07:23,  4.98s/it]     71%|███████   | 211/299 [17:29<07:20,  5.00s/it]     71%|███████   | 212/299 [17:34<07:15,  5.00s/it]     71%|███████   | 213/299 [17:39<07:09,  5.00s/it]     72%|███████▏  | 214/299 [17:44<07:04,  4.99s/it]     72%|███████▏  | 215/299 [17:49<06:59,  4.99s/it]     72%|███████▏  | 216/299 [17:54<06:53,  4.99s/it]     73%|███████▎  | 217/299 [17:59<06:48,  4.98s/it]     73%|███████▎  | 218/299 [18:04<06:43,  4.98s/it]     73%|███████▎  | 219/299 [18:09<06:39,  4.99s/it]     74%|███████▎  | 220/299 [18:14<06:34,  4.99s/it]     74%|███████▍  | 221/299 [18:19<06:29,  4.99s/it]     74%|███████▍  | 222/299 [18:24<06:24,  4.99s/it]     75%|███████▍  | 223/299 [18:29<06:19,  5.00s/it]     75%|███████▍  | 224/299 [18:34<06:15,  5.00s/it]     75%|███████▌  | 225/299 [18:39<06:10,  5.01s/it]     76%|███████▌  | 226/299 [18:44<06:05,  5.00s/it]     76%|███████▌  | 227/299 [18:49<06:00,  5.01s/it]     76%|███████▋  | 228/299 [18:54<05:55,  5.01s/it]     77%|███████▋  | 229/299 [18:59<05:50,  5.00s/it]     77%|███████▋  | 230/299 [19:04<05:44,  5.00s/it]     77%|███████▋  | 231/299 [19:09<05:40,  5.00s/it]     78%|███████▊  | 232/299 [19:14<05:35,  5.00s/it]     78%|███████▊  | 233/299 [19:19<05:30,  5.00s/it]     78%|███████▊  | 234/299 [19:24<05:25,  5.00s/it]     79%|███████▊  | 235/299 [19:29<05:20,  5.00s/it]     79%|███████▉  | 236/299 [19:34<05:15,  5.00s/it]     79%|███████▉  | 237/299 [19:39<05:09,  4.99s/it]     80%|███████▉  | 238/299 [19:44<05:04,  4.99s/it]     80%|███████▉  | 239/299 [19:49<04:59,  5.00s/it]     80%|████████  | 240/299 [19:54<04:54,  4.99s/it]     81%|████████  | 241/299 [19:59<04:49,  4.99s/it]     81%|████████  | 242/299 [20:04<04:44,  4.99s/it]     81%|████████▏ | 243/299 [20:09<04:39,  4.99s/it]     82%|████████▏ | 244/299 [20:14<04:34,  4.99s/it]     82%|████████▏ | 245/299 [20:19<04:29,  4.99s/it]     82%|████████▏ | 246/299 [20:24<04:24,  4.98s/it]     83%|████████▎ | 247/299 [20:29<04:19,  4.99s/it]     83%|████████▎ | 248/299 [20:34<04:14,  4.99s/it]     83%|████████▎ | 249/299 [20:39<04:09,  5.00s/it]     84%|████████▎ | 250/299 [20:44<04:04,  5.00s/it]     84%|████████▍ | 251/299 [20:49<03:59,  4.99s/it]     84%|████████▍ | 252/299 [20:54<03:54,  4.99s/it]     85%|████████▍ | 253/299 [20:59<03:49,  4.99s/it]     85%|████████▍ | 254/299 [21:04<03:44,  4.99s/it]     85%|████████▌ | 255/299 [21:09<03:39,  4.99s/it]     86%|████████▌ | 256/299 [21:14<03:34,  4.99s/it]     86%|████████▌ | 257/299 [21:19<03:29,  4.99s/it]     86%|████████▋ | 258/299 [21:24<03:24,  4.99s/it]     87%|████████▋ | 259/299 [21:29<03:19,  5.00s/it]     87%|████████▋ | 260/299 [21:34<03:14,  4.99s/it]     87%|████████▋ | 261/299 [21:39<03:09,  4.99s/it]     88%|████████▊ | 262/299 [21:44<03:04,  5.00s/it]     88%|████████▊ | 263/299 [21:49<02:59,  5.00s/it]     88%|████████▊ | 264/299 [21:54<02:55,  5.00s/it]     89%|████████▊ | 265/299 [21:59<02:50,  5.00s/it]     89%|████████▉ | 266/299 [22:04<02:44,  5.00s/it]     89%|████████▉ | 267/299 [22:09<02:40,  5.00s/it]     90%|████████▉ | 268/299 [22:14<02:34,  5.00s/it]     90%|████████▉ | 269/299 [22:19<02:30,  5.00s/it]     90%|█████████ | 270/299 [22:24<02:24,  5.00s/it]     91%|█████████ | 271/299 [22:29<02:19,  5.00s/it]     91%|█████████ | 272/299 [22:34<02:15,  5.00s/it]     91%|█████████▏| 273/299 [22:39<02:10,  5.00s/it]     92%|█████████▏| 274/299 [22:44<02:04,  4.99s/it]     92%|█████████▏| 275/299 [22:49<01:59,  4.99s/it]     92%|█████████▏| 276/299 [22:54<01:54,  4.99s/it]     93%|█████████▎| 277/299 [22:59<01:49,  4.98s/it]     93%|█████████▎| 278/299 [23:04<01:44,  4.98s/it]     93%|█████████▎| 279/299 [23:09<01:39,  4.98s/it]     94%|█████████▎| 280/299 [23:14<01:34,  4.98s/it]     94%|█████████▍| 281/299 [23:19<01:29,  4.98s/it]     94%|█████████▍| 282/299 [23:24<01:24,  4.98s/it]     95%|█████████▍| 283/299 [23:29<01:19,  4.98s/it]     95%|█████████▍| 284/299 [23:34<01:14,  4.98s/it]     95%|█████████▌| 285/299 [23:39<01:09,  4.98s/it]     96%|█████████▌| 286/299 [23:44<01:04,  4.98s/it]     96%|█████████▌| 287/299 [23:49<00:59,  4.99s/it]     96%|█████████▋| 288/299 [23:54<00:54,  4.99s/it]     97%|█████████▋| 289/299 [23:59<00:49,  4.98s/it]     97%|█████████▋| 290/299 [24:04<00:44,  4.98s/it]     97%|█████████▋| 291/299 [24:09<00:39,  4.98s/it]     98%|█████████▊| 292/299 [24:14<00:34,  4.98s/it]     98%|█████████▊| 293/299 [24:19<00:29,  4.97s/it]     98%|█████████▊| 294/299 [24:24<00:24,  4.97s/it]     99%|█████████▊| 295/299 [24:29<00:19,  4.98s/it]     99%|█████████▉| 296/299 [24:34<00:14,  4.98s/it]     99%|█████████▉| 297/299 [24:38<00:09,  4.98s/it]    100%|█████████▉| 298/299 [24:43<00:04,  4.97s/it]    100%|██████████| 299/299 [24:48<00:00,  4.97s/it]    100%|██████████| 299/299 [24:48<00:00,  4.98s/it]




.. GENERATED FROM PYTHON SOURCE LINES 437-451

We obtain the following posterior trajectory

.. container:: image-col

   .. image-sg-ignore:: /auto_examples/images/posterior_sample_DRUNet.png
      :alt: posterior sample DRUNet
      :srcset: /auto_examples/images/posterior_sample_DRUNet.png
      :ignore_missing: true

   .. image-sg-ignore:: /auto_examples/images/posterior_sample_DRUNet.gif
      :alt: posterior trajectory DRUNet
      :srcset: /auto_examples/images/posterior_sample_DRUNet.gif
      :ignore_missing: true
      :class: custom-gif

.. GENERATED FROM PYTHON SOURCE LINES 453-455

We can switch to a different denoiser, for example, the DiffUNet denoiser from the EDM framework.


.. GENERATED FROM PYTHON SOURCE LINES 456-517

.. code-block:: Python

    denoiser = dinv.models.DiffUNet(pretrained="download").to(device)

    sigma_min = 0.02
    sigma_max = 100
    rng = torch.Generator(device)
    timesteps = torch.linspace(1, 0.001, 200)
    solver = EulerSolver(timesteps=timesteps, rng=rng)
    sde = VarianceExplodingDiffusion(
        sigma_max=sigma_max, sigma_min=sigma_min, alpha=1.0, device=device, dtype=dtype
    )

    # sde = VariancePreservingDiffusion(device=device, dtype=dtype)
    x = dinv.utils.load_url_image(
        dinv.utils.demo.get_image_url("celeba_example.jpg"),
        img_size=256,
        resize_mode="resize",
    ).to(device)

    physics = dinv.physics.Inpainting(
        mask=0.5,
        tensor_size=x.shape[1:],
        device=device,
    )

    y = physics(x)

    model = PosteriorDiffusion(
        data_fidelity=DPSDataFidelity(denoiser=denoiser),
        denoiser=denoiser,
        sde=sde,
        solver=solver,
        dtype=dtype,
        device=device,
        verbose=True,
    )

    # To perform posterior sampling, we need to provide the measurements, the physics and the solver.
    x_hat, trajectory = model(
        y=y,
        physics=physics,
        seed=None,
        get_trajectory=True,
    )
    # Here, we plot the original image, the measurement and the posterior sample
    dinv.utils.plot(
        [x, y, x_hat],
        show=True,
        titles=["Original", "Measurement", "Posterior sample DiffUNet"],
        save_fn="posterior_sample_DiffUNet.png",
        figsize=(figsize * 3, figsize),
    )
    # We can also save the trajectory of the posterior sample
    dinv.utils.save_videos(
        trajectory[::gif_frequency],
        time_dim=0,
        titles=["Posterior trajectory DiffUNet"],
        save_fn="posterior_sample_DiffUNet.gif",
        figsize=(figsize, figsize),
    )






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

      0%|          | 0/199 [00:00<?, ?it/s]      1%|          | 1/199 [00:08<26:25,  8.01s/it]      1%|          | 2/199 [00:15<25:36,  7.80s/it]      2%|▏         | 3/199 [00:23<25:08,  7.69s/it]      2%|▏         | 4/199 [00:30<24:46,  7.62s/it]      3%|▎         | 5/199 [00:38<24:31,  7.58s/it]      3%|▎         | 6/199 [00:45<24:15,  7.54s/it]      4%|▎         | 7/199 [00:53<24:03,  7.52s/it]      4%|▍         | 8/199 [01:00<23:54,  7.51s/it]      5%|▍         | 9/199 [01:08<23:47,  7.51s/it]      5%|▌         | 10/199 [01:15<23:38,  7.51s/it]      6%|▌         | 11/199 [01:23<23:31,  7.51s/it]      6%|▌         | 12/199 [01:30<23:23,  7.51s/it]      7%|▋         | 13/199 [01:38<23:13,  7.49s/it]      7%|▋         | 14/199 [01:45<23:05,  7.49s/it]      8%|▊         | 15/199 [01:53<22:56,  7.48s/it]      8%|▊         | 16/199 [02:00<22:48,  7.48s/it]      9%|▊         | 17/199 [02:08<22:40,  7.47s/it]      9%|▉         | 18/199 [02:15<22:31,  7.47s/it]     10%|▉         | 19/199 [02:22<22:23,  7.46s/it]     10%|█         | 20/199 [02:30<22:14,  7.45s/it]     11%|█         | 21/199 [02:37<22:05,  7.45s/it]     11%|█         | 22/199 [02:45<21:57,  7.44s/it]     12%|█▏        | 23/199 [02:52<21:50,  7.44s/it]     12%|█▏        | 24/199 [03:00<21:42,  7.44s/it]     13%|█▎        | 25/199 [03:07<21:34,  7.44s/it]     13%|█▎        | 26/199 [03:15<21:29,  7.45s/it]     14%|█▎        | 27/199 [03:22<21:22,  7.46s/it]     14%|█▍        | 28/199 [03:29<21:14,  7.45s/it]     15%|█▍        | 29/199 [03:37<21:06,  7.45s/it]     15%|█▌        | 30/199 [03:44<21:00,  7.46s/it]     16%|█▌        | 31/199 [03:52<20:54,  7.47s/it]     16%|█▌        | 32/199 [03:59<20:46,  7.46s/it]     17%|█▋        | 33/199 [04:07<20:39,  7.46s/it]     17%|█▋        | 34/199 [04:14<20:29,  7.45s/it]     18%|█▊        | 35/199 [04:22<20:20,  7.44s/it]     18%|█▊        | 36/199 [04:29<20:11,  7.43s/it]     19%|█▊        | 37/199 [04:36<20:03,  7.43s/it]     19%|█▉        | 38/199 [04:44<19:55,  7.42s/it]     20%|█▉        | 39/199 [04:51<19:46,  7.42s/it]     20%|██        | 40/199 [04:59<19:38,  7.41s/it]     21%|██        | 41/199 [05:06<19:30,  7.41s/it]     21%|██        | 42/199 [05:13<19:22,  7.41s/it]     22%|██▏       | 43/199 [05:21<19:15,  7.41s/it]     22%|██▏       | 44/199 [05:28<19:09,  7.41s/it]     23%|██▎       | 45/199 [05:36<19:02,  7.42s/it]     23%|██▎       | 46/199 [05:43<18:54,  7.41s/it]     24%|██▎       | 47/199 [05:51<18:48,  7.43s/it]     24%|██▍       | 48/199 [05:58<18:40,  7.42s/it]     25%|██▍       | 49/199 [06:05<18:32,  7.42s/it]     25%|██▌       | 50/199 [06:13<18:25,  7.42s/it]     26%|██▌       | 51/199 [06:20<18:18,  7.42s/it]     26%|██▌       | 52/199 [06:28<18:09,  7.41s/it]     27%|██▋       | 53/199 [06:35<18:02,  7.41s/it]     27%|██▋       | 54/199 [06:42<17:54,  7.41s/it]     28%|██▊       | 55/199 [06:50<17:47,  7.41s/it]     28%|██▊       | 56/199 [06:57<17:39,  7.41s/it]     29%|██▊       | 57/199 [07:05<17:33,  7.42s/it]     29%|██▉       | 58/199 [07:12<17:25,  7.42s/it]     30%|██▉       | 59/199 [07:20<17:18,  7.42s/it]     30%|███       | 60/199 [07:27<17:11,  7.42s/it]     31%|███       | 61/199 [07:34<17:04,  7.42s/it]     31%|███       | 62/199 [07:42<16:57,  7.42s/it]     32%|███▏      | 63/199 [07:49<16:50,  7.43s/it]     32%|███▏      | 64/199 [07:57<16:43,  7.43s/it]     33%|███▎      | 65/199 [08:04<16:38,  7.45s/it]     33%|███▎      | 66/199 [08:12<16:32,  7.46s/it]     34%|███▎      | 67/199 [08:19<16:24,  7.46s/it]     34%|███▍      | 68/199 [08:27<16:16,  7.45s/it]     35%|███▍      | 69/199 [08:34<16:09,  7.46s/it]     35%|███▌      | 70/199 [08:42<16:02,  7.46s/it]     36%|███▌      | 71/199 [08:49<15:53,  7.45s/it]     36%|███▌      | 72/199 [08:56<15:45,  7.44s/it]     37%|███▋      | 73/199 [09:04<15:37,  7.44s/it]     37%|███▋      | 74/199 [09:11<15:28,  7.43s/it]     38%|███▊      | 75/199 [09:19<15:20,  7.43s/it]     38%|███▊      | 76/199 [09:26<15:13,  7.43s/it]     39%|███▊      | 77/199 [09:34<15:06,  7.43s/it]     39%|███▉      | 78/199 [09:41<14:58,  7.43s/it]     40%|███▉      | 79/199 [09:48<14:51,  7.43s/it]     40%|████      | 80/199 [09:56<14:43,  7.42s/it]     41%|████      | 81/199 [10:03<14:35,  7.42s/it]     41%|████      | 82/199 [10:11<14:29,  7.43s/it]     42%|████▏     | 83/199 [10:18<14:22,  7.44s/it]     42%|████▏     | 84/199 [10:26<14:15,  7.44s/it]     43%|████▎     | 85/199 [10:33<14:08,  7.44s/it]     43%|████▎     | 86/199 [10:40<14:00,  7.44s/it]     44%|████▎     | 87/199 [10:48<13:52,  7.43s/it]     44%|████▍     | 88/199 [10:55<13:44,  7.43s/it]     45%|████▍     | 89/199 [11:03<13:36,  7.42s/it]     45%|████▌     | 90/199 [11:10<13:28,  7.42s/it]     46%|████▌     | 91/199 [11:18<13:23,  7.44s/it]     46%|████▌     | 92/199 [11:25<13:15,  7.43s/it]     47%|████▋     | 93/199 [11:32<13:06,  7.42s/it]     47%|████▋     | 94/199 [11:40<12:59,  7.42s/it]     48%|████▊     | 95/199 [11:47<12:51,  7.42s/it]     48%|████▊     | 96/199 [11:55<12:43,  7.41s/it]     49%|████▊     | 97/199 [12:02<12:36,  7.42s/it]     49%|████▉     | 98/199 [12:09<12:29,  7.42s/it]     50%|████▉     | 99/199 [12:17<12:23,  7.43s/it]     50%|█████     | 100/199 [12:24<12:16,  7.44s/it]     51%|█████     | 101/199 [12:32<12:08,  7.43s/it]     51%|█████▏    | 102/199 [12:39<12:00,  7.43s/it]     52%|█████▏    | 103/199 [12:47<11:52,  7.43s/it]     52%|█████▏    | 104/199 [12:54<11:44,  7.42s/it]     53%|█████▎    | 105/199 [13:01<11:37,  7.42s/it]     53%|█████▎    | 106/199 [13:09<11:29,  7.41s/it]     54%|█████▍    | 107/199 [13:16<11:22,  7.42s/it]     54%|█████▍    | 108/199 [13:24<11:15,  7.42s/it]     55%|█████▍    | 109/199 [13:31<11:07,  7.42s/it]     55%|█████▌    | 110/199 [13:39<11:00,  7.43s/it]     56%|█████▌    | 111/199 [13:46<10:53,  7.43s/it]     56%|█████▋    | 112/199 [13:53<10:46,  7.43s/it]     57%|█████▋    | 113/199 [14:01<10:39,  7.44s/it]     57%|█████▋    | 114/199 [14:08<10:31,  7.43s/it]     58%|█████▊    | 115/199 [14:16<10:23,  7.43s/it]     58%|█████▊    | 116/199 [14:23<10:17,  7.43s/it]     59%|█████▉    | 117/199 [14:31<10:09,  7.43s/it]     59%|█████▉    | 118/199 [14:38<10:02,  7.43s/it]     60%|█████▉    | 119/199 [14:45<09:53,  7.42s/it]     60%|██████    | 120/199 [14:53<09:46,  7.42s/it]     61%|██████    | 121/199 [15:00<09:39,  7.43s/it]     61%|██████▏   | 122/199 [15:08<09:32,  7.43s/it]     62%|██████▏   | 123/199 [15:15<09:25,  7.44s/it]     62%|██████▏   | 124/199 [15:23<09:18,  7.45s/it]     63%|██████▎   | 125/199 [15:30<09:11,  7.46s/it]     63%|██████▎   | 126/199 [15:38<09:04,  7.46s/it]     64%|██████▍   | 127/199 [15:45<08:57,  7.47s/it]     64%|██████▍   | 128/199 [15:53<08:49,  7.46s/it]     65%|██████▍   | 129/199 [16:00<08:42,  7.46s/it]     65%|██████▌   | 130/199 [16:07<08:34,  7.45s/it]     66%|██████▌   | 131/199 [16:15<08:25,  7.43s/it]     66%|██████▋   | 132/199 [16:22<08:17,  7.43s/it]     67%|██████▋   | 133/199 [16:30<08:09,  7.42s/it]     67%|██████▋   | 134/199 [16:37<08:02,  7.43s/it]     68%|██████▊   | 135/199 [16:44<07:54,  7.42s/it]     68%|██████▊   | 136/199 [16:52<07:47,  7.42s/it]     69%|██████▉   | 137/199 [16:59<07:40,  7.42s/it]     69%|██████▉   | 138/199 [17:07<07:32,  7.43s/it]     70%|██████▉   | 139/199 [17:14<07:25,  7.43s/it]     70%|███████   | 140/199 [17:22<07:19,  7.44s/it]     71%|███████   | 141/199 [17:29<07:11,  7.45s/it]     71%|███████▏  | 142/199 [17:37<07:04,  7.45s/it]     72%|███████▏  | 143/199 [17:44<06:57,  7.45s/it]     72%|███████▏  | 144/199 [17:51<06:49,  7.45s/it]     73%|███████▎  | 145/199 [17:59<06:42,  7.45s/it]     73%|███████▎  | 146/199 [18:06<06:34,  7.45s/it]     74%|███████▍  | 147/199 [18:14<06:27,  7.45s/it]     74%|███████▍  | 148/199 [18:21<06:20,  7.45s/it]     75%|███████▍  | 149/199 [18:29<06:12,  7.45s/it]     75%|███████▌  | 150/199 [18:36<06:04,  7.44s/it]     76%|███████▌  | 151/199 [18:44<05:57,  7.44s/it]     76%|███████▋  | 152/199 [18:51<05:49,  7.43s/it]     77%|███████▋  | 153/199 [18:58<05:41,  7.43s/it]     77%|███████▋  | 154/199 [19:06<05:34,  7.43s/it]     78%|███████▊  | 155/199 [19:13<05:26,  7.43s/it]     78%|███████▊  | 156/199 [19:21<05:19,  7.44s/it]     79%|███████▉  | 157/199 [19:28<05:11,  7.43s/it]     79%|███████▉  | 158/199 [19:36<05:04,  7.43s/it]     80%|███████▉  | 159/199 [19:43<04:57,  7.43s/it]     80%|████████  | 160/199 [19:50<04:49,  7.43s/it]     81%|████████  | 161/199 [19:58<04:42,  7.43s/it]     81%|████████▏ | 162/199 [20:05<04:34,  7.42s/it]     82%|████████▏ | 163/199 [20:13<04:27,  7.42s/it]     82%|████████▏ | 164/199 [20:20<04:19,  7.43s/it]     83%|████████▎ | 165/199 [20:28<04:13,  7.45s/it]     83%|████████▎ | 166/199 [20:35<04:05,  7.44s/it]     84%|████████▍ | 167/199 [20:42<03:57,  7.43s/it]     84%|████████▍ | 168/199 [20:50<03:49,  7.42s/it]     85%|████████▍ | 169/199 [20:57<03:42,  7.42s/it]     85%|████████▌ | 170/199 [21:05<03:34,  7.41s/it]     86%|████████▌ | 171/199 [21:12<03:27,  7.41s/it]     86%|████████▋ | 172/199 [21:19<03:20,  7.42s/it]     87%|████████▋ | 173/199 [21:27<03:12,  7.42s/it]     87%|████████▋ | 174/199 [21:34<03:05,  7.43s/it]     88%|████████▊ | 175/199 [21:42<02:58,  7.44s/it]     88%|████████▊ | 176/199 [21:49<02:51,  7.45s/it]     89%|████████▉ | 177/199 [21:57<02:43,  7.43s/it]     89%|████████▉ | 178/199 [22:04<02:36,  7.45s/it]     90%|████████▉ | 179/199 [22:12<02:28,  7.45s/it]     90%|█████████ | 180/199 [22:19<02:21,  7.46s/it]     91%|█████████ | 181/199 [22:27<02:14,  7.45s/it]     91%|█████████▏| 182/199 [22:34<02:06,  7.44s/it]     92%|█████████▏| 183/199 [22:41<01:58,  7.43s/it]     92%|█████████▏| 184/199 [22:49<01:51,  7.43s/it]     93%|█████████▎| 185/199 [22:56<01:44,  7.43s/it]     93%|█████████▎| 186/199 [23:04<01:36,  7.43s/it]     94%|█████████▍| 187/199 [23:11<01:29,  7.43s/it]     94%|█████████▍| 188/199 [23:19<01:21,  7.43s/it]     95%|█████████▍| 189/199 [23:26<01:14,  7.43s/it]     95%|█████████▌| 190/199 [23:33<01:06,  7.43s/it]     96%|█████████▌| 191/199 [23:41<00:59,  7.43s/it]     96%|█████████▋| 192/199 [23:48<00:52,  7.44s/it]     97%|█████████▋| 193/199 [23:56<00:44,  7.44s/it]     97%|█████████▋| 194/199 [24:03<00:37,  7.43s/it]     98%|█████████▊| 195/199 [24:11<00:29,  7.44s/it]     98%|█████████▊| 196/199 [24:18<00:22,  7.44s/it]     99%|█████████▉| 197/199 [24:26<00:14,  7.45s/it]     99%|█████████▉| 198/199 [24:33<00:07,  7.44s/it]    100%|██████████| 199/199 [24:40<00:00,  7.44s/it]    100%|██████████| 199/199 [24:40<00:00,  7.44s/it]




.. GENERATED FROM PYTHON SOURCE LINES 537-551

We obtain the following posterior trajectory

.. container:: image-col

   .. image-sg-ignore:: /auto_examples/images/posterior_sample_DiffUNet.png
      :alt: posterior sample DiffUNet
      :srcset: /auto_examples/images/posterior_sample_DiffUNet.png
      :ignore_missing: true

   .. image-sg-ignore:: /auto_examples/images/posterior_sample_DiffUNet.gif
      :alt: posterior trajectory DiffUNet
      :srcset: /auto_examples/images/posterior_sample_DiffUNet.gif
      :ignore_missing: true
      :class: custom-gif


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (64 minutes 2.624 seconds)


.. _sphx_glr_download_auto_examples_sampling_demo_diffusion_sde.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: demo_diffusion_sde.ipynb <demo_diffusion_sde.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: demo_diffusion_sde.py <demo_diffusion_sde.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: demo_diffusion_sde.zip <demo_diffusion_sde.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
